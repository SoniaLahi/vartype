<html lang="en" onclick="keyPressed()" ontouchstart="touchScreen()">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variab</title>
    <link href="stylesheet.css" rel='stylesheet' type='text/css'>
</head>
    <body onload="start()" onkeydown="keyPressed()">

		<header id="headerscore" class="header">
		    <div>
			<p class="aligncenter"><strong> (c) </strong>to<br> collection </p>
		    </div>
		    <div>
		    <p class="aligncenter"><strong> (s) </strong>to<br> exit</p>
		    </div>
		</header>
		<header id="headerready" class="header">
			<div>
				<p class="aligncenter"><strong> (c) </strong>to<br> collection </p>
			</div>
			<div style="text-align: center;font-size: 32px;font-weight: 200; margin-top: -20px;">
				<p>Level 0</p>
			</div>
			<div>
			<p class="aligncenter"><strong> (s) </strong>to<br> settings </p>
			</div>
		</header>
		<header id="headerlevel" class="header">
			<div>
				<p style="text-align: center;font-size: 32px;font-weight: 200; margin-bottom: 0;">Level 0</p>
				<p style="margin: 0;">01/04</p>
			</div>
		</header>		
		<header id="headercollection" class="header">
			<div>
				<p class="aligncenter"><strong> (c) </strong>to<br> exit </p>
			</div>
			<div>
			<p class="aligncenter"><strong> (s) </strong>to<br> settings </p>
			</div>
		</header>
		<header id="headersettings" class="header">
			<div>
				<p class="aligncenter"><strong> (c) </strong>to<br> collection </p>
			</div>
			<div>
			<p class="aligncenter"><strong> (s) </strong>to<br> exit </p>
			</div>
		</header>

         <div class="main" id="game">
			<div style="width: 100%; margin:0 auto;">
				<div style="height: 25vw; position: relative;">
					<p id="affiche">Error</p>
					<div class="textpar">
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 450;" id="RobotoMono">monospace</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 400;font-family: 'EBGaramond-VariableFont_wght';" class="EBGaramond">serif</p>
					<p class="text" style="font-variation-settings:'wght' 700;font-family: 'EBGaramond-VariableFont_wght';" class="EBGaramond">garalde</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 300;font-family: 'Quicksand-VariableFont_wght';" class="Quicksand">sans serif</p>
					<p class="text" style="font-variation-settings:'wght' 500;font-family: 'Quicksand-VariableFont_wght';" class="Quicksand">rounded</p>
					<p class="text" style="font-variation-settings:'wght' 650;font-family: 'Quicksand-VariableFont_wght';" class="Quicksand">geometric</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 400;font-family: 'Hagrid-Variable-trial';" class="Hagrid">original</p>
					<p class="text" style="font-variation-settings:'wght' 1000;font-family: 'Hagrid-Variable-trial';" class="Hagrid">weird</p>
					<p class="text" style="font-variation-settings:'wght' 100;font-family: 'Hagrid-Variable-trial';" class="Hagrid">modular</p>
					<p class="text" style="font-variation-settings:'wght' 750;font-family: 'Hagrid-Variable-trial';" class="Hagrid">quircky</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 0;font-family: 'Minerale-variable-TRIAL';" class="Minerale">triangles</p>
					<p class="text" style="font-variation-settings:'wght' 700;font-family: 'Minerale-variable-TRIAL';" class="Minerale">stems</p>
					<p class="text" style="font-variation-settings:'wght' 100;font-family: 'Minerale-variable-TRIAL';" class="Minerale">french</p>
					<p class="text" style="font-variation-settings:'wght' 1000;font-family: 'Minerale-variable-TRIAL';" class="Minerale">multiplexed</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 100, 'slnt' 0;font-family: 'Inter Var';" class="Inter">screens</p>
					<p class="text" style="font-variation-settings:'wght' 900, 'slnt' -10;font-family: 'Inter Var';" class="Inter">readability</p>
					<p class="text" style="font-variation-settings:'wght' 600, 'slnt' -6;font-family: 'Inter Var';" class="Inter">open source</p>
					<p class="text" style="font-variation-settings:'wght' 200, 'slnt' -2;font-family: 'Inter Var';" class="Inter">grotesk</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 499, 'opsz' 1000;font-family: 'Blacker-Sans-Variable-trial';" class="Blacker">classy</p>
					<p class="text" style="font-variation-settings:'wght' 50, 'opsz' 100;font-family: 'Blacker-Sans-Variable-trial';" class="Blacker">evilserif</p>
					<p class="text" style="font-variation-settings:'wght' 200, 'opsz' 800;font-family: 'Blacker-Sans-Variable-trial';" class="Blacker">contrast</p>
					<p class="text" style="font-variation-settings:'wght' 400, 'opsz' 100;font-family: 'Blacker-Sans-Variable-trial';" class="Blacker">style</p>
					</div>
				        <div class="textpar">
					<p class="text" style="font-variation-settings:'wdth' 10, 'wght' 100;font-family: 'Compressa';" class="Compressa">display</p>
					<p class="text" style="font-variation-settings:'wdth' 200, 'wght' 1000;font-family: 'Compressa';" class="Compressa">vernacular</p>
					<p class="text" style="font-variation-settings:'wdth' 50, 'wght' 400;font-family: 'Compressa';" class="Compressa">straight sided</p>
					<p class="text" style="font-variation-settings:'wdth' 200, 'wght' 900;font-family: 'Compressa';" class="Compressa">legibility</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wdth' 0, 'wght' 100, 'ital' 0;font-family: 'GT\ Flexa\ VAR\ Trial';" class="GTFlexa">unique</p>
					<p class="text" style="font-variation-settings:'wdth' 200, 'wght' 800, 'ital' 100;font-family: 'GT\ Flexa\ VAR\ Trial';" class="GTFlexa">responsivity</p>
					<p class="text" style="font-variation-settings:'wdth' 150, 'wght' 250, 'ital' 75;font-family: 'GT\ Flexa\ VAR\ Trial';" class="GTFlexa">adaptative</p>
					<p class="text" style="font-variation-settings:'wdth' 50, 'wght' 700, 'ital' 50;font-family: 'GT\ Flexa\ VAR\ Trial';" class="GTFlexa">system</p>
					</div>
				</div>
				<div style="height:20px; width:70%; margin:0 auto;">
					<div style="height:5px; border-radius:5px; background-color:black; margin:auto; top:75%; position:relative; -ms-transform: translateY(-50%);transform: translateY(-50%);"></div>
					<div class="slider"></div>
					<div style="display:none; height:20px; width:5px; border-radius:5px; background-color:black; margin:auto; top:75%; position:relative; -ms-transform: translateY(-50%);transform: translateY(-50%);" id="helper"></div>
				</div>
				<p class="currant" id="spacebar">press <strong>(spacebar)</strong><br>to validate</p>
				<p class="r" style="position:absolute; top:0; left:0;"></p>
			</div>
		</div>
		
		<div class="main" style="display:none"  id="score">
			<div class="containerscore" class="settingssize">
				<div class="elementscore">
					<p class="currant"> Level 0 - <strong>100%</strong></p>
				</div>
				<div class="elementscore" style="display: flex;">
					<div>
						<p>steps</p>
					</div>
					<div>
						<p>precision</p>
					</div>
					<div>
						<p>reactivity</p>
					</div>
					<div>
						<p>score</p>
					</div>
				</div>
				<div class="elementscore" style="display: flex;text-align: right;" id="scoreboard">
					<div style="margin-left: 20px;">
						<p>01</p>
						<p>02</p>
						<p>03</p>
						<p>04</p>
					</div>
					<div>
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
					</div>
					<div>
						<p>0</p>
						<p>0</p>
						<p>0</p>
						<p>0</p>
					</div>
					<div style="font-weight: 600;">
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
					</div>
				</div>
				<div class="elementscore" style="text-align: center;margin-top:20px;display: flex; justify-content: space-evenly;">
					<p>Press <strong>(r)</strong><br> to try again</p>
					<p>Press <strong>(spacebar)</strong><br> to start the<br> next level</p>
				</div>
			</div>
		</div>
		<script>
		var k=false;
		var id = setInterval(loop, 10);
		var touch=false,t=0,sldr,r,lvl=1,step=0,score=[],penalty=[],press=-1000,prm=[],str,mode=0,fontvar,totalscore,waitinput=false;
		var font=["RobotoMono","EBGaramond","Quicksand","Hagrid","Minerale","Inter","Blacker","GTFlexa","Compressa"];
		var fmin=[[100],[400],[300],[100] ,[0   ],[100,-10],[50 ,100 ],[0  ,100,0  ],[10 ,100 ]];
		var fmax=[[800],[800],[700],[1000],[1000],[900,0  ],[499,1000],[200,800,100],[200,1000]];
		var fout;
		function loop() {
			switch(mode) {
				case 0:
					loadReady();
					mode=1;
					break;
				case 1:
					//Wait Input
					ready();
					break;
				case 2:
					//Play Game
					if(step==Math.min(lvl,4)) {
						mode++;
						k=false;
					} else {
						level(lvl<4,lvl);
					}
					break;
				case 3:
					//Load Scoreboard
					scoreboard(lvl>2);
					break;
				case 4:
					//Wait
					waitscore();
					break;
				case 5:
					mode=0;
					lvl++;
					step=0;
			}
			function loadReady() {
				//Load Ready?
				t=0;
				document.getElementById("headerready").style.display="flex";
				document.getElementById("headerready").children[1].children[0].innerHTML="Level "+lvl;
				document.getElementById("affiche").innerHTML="Ready?";
				document.getElementById("affiche").style.opacity=1;
				document.getElementsByClassName("slider")[0].style.opacity=1;
				if(touch) {
					document.getElementById("spacebar").innerHTML="Touch the screen<br>to start";
				} else {
					document.getElementById("spacebar").innerHTML="Press <strong>(spacebar)</strong><br>to start";				
				}
				document.getElementById("spacebar").style.opacity=1;
				document.getElementById("helper").style.display="none";
			}
			function ready() {
				t++;
				sldr=-Math.cos(t/200*Math.PI)/2+.5;
				document.getElementsByClassName("slider")[0].style.marginLeft=sldr*100+"%";
				if(k==true) {
					mode++;
					t=-200;
					document.getElementById("headerready").style.display="none";
					document.getElementById("headerlevel").style.display="flex";
					document.getElementById("headerlevel").children[0].children[0].innerHTML="Level "+lvl;
					document.getElementById("headerlevel").children[0].children[1].innerHTML=0+"/"+Math.min(lvl,4);
				}
			}
			function level(wait,flash) {
				if(flash<4) {
					if(t==-200) {
						startLevel();
						loadFontSettings();
						document.getElementById("affiche").style.opacity=1;
						document.getElementsByClassName("slider")[0].style.opacity=0;
						//k=false;
						document.getElementById("spacebar").style.opacity=1;
						if(touch) {
							document.getElementById("spacebar").innerHTML="Click the screen<br>to continue";
						} else {
							document.getElementById("spacebar").innerHTML="Press <strong>(spacebar)</strong><br>to continue";
						}
						t=-1;
						if(flash==3) {
							waitinput=true;
							clearInterval(id);
						} else {
							document.getElementsByClassName("textpar")[lvl].children[step].style.display="block";
						}
					} else if(t==0) { 
						startGame();
					}
					t++;
				}
				if(flash>3) {
					switch(t) {
						case -200:
							startLevel();
							break;
						case -120:
							loadFontSettings();
							//Flash On
							document.getElementById("affiche").style.opacity=1;
							break;
						case -80:
							//Flash Off
							document.getElementById("affiche").style.opacity=0;
							break;
						case 0:
							startGame();
							break;
					}
					t++;
				}
				
				if(0<t) {
					if(wait) {
						if(press==-1000) {
							moveGame();
							if(k){
								//Wait Player Input
								saveScore();
								if(touch) {
									document.getElementById("spacebar").innerHTML="Click the screen<br>to continue";
								} else {
									document.getElementById("spacebar").innerHTML="Press <strong>(spacebar)</strong><br>to continue";
								}
								waitinput=true;
								clearInterval(id);
							}
						} else {
							resetAdvance();
						}
					}
					else {
						if(press==-1000) {
							moveGame();
							if(k) {
								saveScore();
								document.getElementById("spacebar").style.opacity=0;
							}
						}
						if(press==t-100) {
							resetAdvance();
						}
					}
				}
				function startLevel() {
					if(flash==1) {
						document.getElementById("helper").style.display="block";
					}
					document.getElementsByClassName("slider")[0].style.opacity=0;
					if(touch) {
						document.getElementById("spacebar").innerHTML="Click the screen<br>to validate";
					} else {
						document.getElementById("spacebar").innerHTML="Hit <strong>(spacebar)</strong><br>to validate";					
					}
					document.getElementById("spacebar").style.opacity=0;
					document.getElementById("affiche").style.opacity=0;
				}
				function loadFontSettings() {
					//Get Font settings 
					document.getElementById("affiche").style.fontFamily=document.getElementsByClassName("textpar")[lvl].children[step].style.fontFamily;
					document.getElementById("affiche").style.fontVariationSettings=document.getElementsByClassName("textpar")[lvl].children[step].style.fontVariationSettings;
					document.getElementById("affiche").innerHTML=document.getElementsByClassName("textpar")[lvl].children[step].innerHTML;
					
					fout=searchFont(document.getElementsByClassName("textpar")[lvl].children[step].getAttribute("id"));
					fontvar= document.getElementsByClassName("textpar")[lvl].children[step].style.fontVariationSettings.split(" ")
					prm=[];
					for(var i=0;i<fout[0].length;i++) {
						prm.push((fontvar[1]-fout[0][i])/(fout[1][i]-fout[0][i]));
					}
					fontvar= fontvar[0];

				}
				
				function startGame() {
					//Start Game
					document.getElementById("affiche").style.opacity=1;
					document.getElementsByClassName("slider")[0].style.marginLeft=0+"%";
					document.getElementsByClassName("slider")[0].style.opacity=1;
					document.getElementById("spacebar").style.opacity=1;
					if(touch) {
						document.getElementById("spacebar").innerHTML= "Click the screen<br>to validate";
					} else {
						document.getElementById("spacebar").innerHTML= "Hit <strong>(spacebar)</strong><br>to validate";
					}
					k=false;
				}
				function moveGame() {
					//Move Game
					r=Math.floor(t/200)+1;
					sldr=-Math.cos(t/200*Math.PI)/2+.5;
					document.getElementById("affiche").style.fontVariationSettings=fontvar+" "+(sldr*(fout[1][0]-fout[0][0])+fout[0][0]);
					document.getElementsByClassName("r")[0].innerHTML=(sldr*(fout[1][0]-fout[0][0])+fout[0][0]);
					document.getElementsByClassName("slider")[0].style.marginLeft=sldr*100+"%";	
				}
				function saveScore() {
					//Save Score/Input Time
					press=t;
					score.push(Math.ceil(100-Math.abs(sldr-prm[0])*100));
					penalty.push(r)
					document.getElementsByClassName("textpar")[lvl].children[step].style.display="block";
					k=false;
				}
				function resetAdvance() {
					//Reset & Advance Game
					document.getElementsByClassName("slider")[0].style.opacity=0.5;
					document.getElementById("affiche").style.opacity=0.5;
					document.getElementById("spacebar").style.opacity=0.5;
					document.getElementsByClassName("textpar")[lvl].children[step].style.display="none";
					step++;
					press=-1000;
					t=-200;
					document.getElementById("headerlevel").children[0].children[1].innerHTML=step+"/"+Math.min(lvl,4);
				}
			}
			function searchFont(fnt) {
				for(var i=0;i<font.length;i++) {
					if(fnt==font[i]) {
						return [fmin[i],fmax[i]];
					}
				}
			}
			function scoreboard(bounce) {
				if(bounce) {
					document.getElementById("score").children[0].children[1].children[2].style.display="block";
					document.getElementById("score").children[0].children[2].children[2].style.display="block";
				} else {
					document.getElementById("score").children[0].children[1].children[2].style.display="none";					
					document.getElementById("score").children[0].children[2].children[2].style.display="none";					
				}
				document.getElementById("headerlevel").style.display="none";
				document.getElementById("headerscore").style.display="flex";
				document.getElementById("score").style.display="flex";
				document.getElementById("game").style.filter= "blur(8px)";
				totalscore=0;
				for(var i=0;i<4;i++) {
					if(i<Math.min(lvl,4)) {
						document.getElementById("score").children[0].children[2].children[0].children[i].style.display="block";					
						document.getElementById("score").children[0].children[2].children[1].children[i].style.display="block";					
						document.getElementById("score").children[0].children[2].children[2].children[i].style.display="block";					
						document.getElementById("score").children[0].children[2].children[3].children[i].style.display="block";					
					} else {
						document.getElementById("score").children[0].children[2].children[0].children[i].style.display="none";					
						document.getElementById("score").children[0].children[2].children[1].children[i].style.display="none";					
						document.getElementById("score").children[0].children[2].children[2].children[i].style.display="none";					
						document.getElementById("score").children[0].children[2].children[3].children[i].style.display="none";		
					
					}
				}
				for(var i=0;i<score.length;i++) {
					if(bounce==false) {
						penalty[i]=1;
					}
					document.getElementById("scoreboard").children[1].children[i].innerHTML=score[i]+"%";
					document.getElementById("scoreboard").children[2].children[i].innerHTML=penalty[i]-1;
					document.getElementById("scoreboard").children[3].children[i].innerHTML=Math.ceil(score[i]/penalty[i])+"%";
					totalscore+=Math.ceil(score[i]/penalty[i]);
				}
				totalscore=Math.floor(totalscore/score.length);
				document.getElementById("scoreboard").parentElement.children[0].children[0].innerHTML=" Level "+lvl+" - <strong>"+totalscore+"%</strong>";
				
				mode++;
				k=false;
			}
			function waitscore() {
				if(k) {
					document.getElementById("headerscore").style.display="none";

					document.getElementById("score").style.display="none";
					document.getElementById("game").style.filter= "none";
					score=[];
					penalty=[];
					k=false;
					mode++;
				}
			}
		}		
		function keyPressed() {
			if(event.key=="Escape") {
				clearInterval(id);
			} else if(waitinput) {
				id = setInterval(loop, 10);
				waitinput=false;
			} else {
				k=true;
			}
		}
		function touchScreen() {
			touch=true;
		}
		</script>
	</body>
</html>
