<html onclick="Click()" ontouchstart="touchScreen()">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VarType</title>
    <link href="stylesheet.css" rel='stylesheet' type='text/css'>
    <script src="script.js"></script>
</head>
    <body onkeydown="keyboard(event)">

		<header id="headerscore" class="header">
		    <div>
			<p class="aligncenter"><strong> (c) </strong>to<br> collection </p>
		    </div>
		    <div>
		    <p class="aligncenter"><strong> (s) </strong>to<br> settings</p>
		    </div>
		</header>
		<header id="headerready" class="header">
			<div>
				<p class="aligncenter"><strong> (c) </strong>to<br> collection </p>
			</div>
			<div style="text-align: center;font-size: clamp(1em, 2vw, 2rem); margin-top: -20px;">
				<p>Level 0</p>
			</div>
			<div>
			<p class="aligncenter"><strong> (s) </strong>to<br> settings </p>
			</div>
		</header>
		<header id="headerlevel" class="header">
			<div>
				<p style="text-align: center;font-size: clamp(1em, 2vw, 2rem); margin: 0;">Level 0</p>
				<p style="margin: 0;">01/04</p>
			</div>
		</header>		
		<header id="headercollection" class="header">
			<div>
				<p class="aligncenter"><strong> (c) </strong>to<br> exit </p>
			</div>
			<div>
			<p class="aligncenter"><strong> (s) </strong>to<br> settings </p>
			</div>
		</header>
		<header id="headersettings" class="header">
			<div>
				<p class="aligncenter"><strong> (c) </strong>to<br> collection </p>
			</div>
			<div>
			<p class="aligncenter"><strong> (s) </strong>to<br> exit </p>
			</div>
		</header>

         <div class="main" id="game">
			<div style="width: 100%; margin:0 auto;">
				<div style="height: 25vw; position: relative;">
					<p id="affiche">Error</p>
					<div class="textpar">
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 450;font-family: RobotoMono;">monospace</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 400;font-family: EBGaramond-VariableFont_wght;">serif</p>
					<p class="text" style="font-variation-settings:'wght' 700;font-family: EBGaramond-VariableFont_wght;">garalde</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 300;font-family: Quicksand-VariableFont_wght;">sans serif</p>
					<p class="text" style="font-variation-settings:'wght' 500;font-family: Quicksand-VariableFont_wght;">rounded</p>
					<p class="text" style="font-variation-settings:'wght' 650;font-family: Quicksand-VariableFont_wght;">geometric</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 400;font-family: Hagrid-Variable-trial;">original</p>
					<p class="text" style="font-variation-settings:'wght' 1000;font-family: Hagrid-Variable-trial;">weird</p>
					<p class="text" style="font-variation-settings:'wght' 100;font-family: Hagrid-Variable-trial;">modular</p>
					<p class="text" style="font-variation-settings:'wght' 750;font-family: Hagrid-Variable-trial;">quircky</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 0;font-family: Minerale-variable-TRIAL;">triangles</p>
					<p class="text" style="font-variation-settings:'wght' 700;font-family: Minerale-variable-TRIAL;">stems</p>
					<p class="text" style="font-variation-settings:'wght' 100;font-family: Minerale-variable-TRIAL;">french</p>
					<p class="text" style="font-variation-settings:'wght' 1000;font-family: Minerale-variable-TRIAL;">multiplexed</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 100, 'slnt' 0;font-family: InterVar;">screens</p>
					<p class="text" style="font-variation-settings:'wght' 900, 'slnt' -10;font-family: InterVar;">readability</p>
					<p class="text" style="font-variation-settings:'wght' 600, 'slnt' -6;font-family: InterVar;">open source</p>
					<p class="text" style="font-variation-settings:'wght' 200, 'slnt' -2;font-family: InterVar;">grotesk</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wght' 499, 'opsz' 1000;font-family: Blacker-Sans-Variable-trial;">classy</p>
					<p class="text" style="font-variation-settings:'wght' 50, 'opsz' 100;font-family: Blacker-Sans-Variable-trial;">evilserif</p>
					<p class="text" style="font-variation-settings:'wght' 200, 'opsz' 800;font-family: Blacker-Sans-Variable-trial;">contrast</p>
					<p class="text" style="font-variation-settings:'wght' 400, 'opsz' 100;font-family: Blacker-Sans-Variable-trial;">style</p>
					</div>
				        <div class="textpar">
					<p class="text" style="font-variation-settings:'wdth' 10, 'wght' 100;font-family: Compressa;">display</p>
					<p class="text" style="font-variation-settings:'wdth' 200, 'wght' 1000;font-family: Compressa;">vernacular</p>
					<p class="text" style="font-variation-settings:'wdth' 50, 'wght' 400;font-family: Compressa;">straight sided</p>
					<p class="text" style="font-variation-settings:'wdth' 200, 'wght' 900;font-family: Compressa;">legibility</p>
					</div>
					<div class="textpar">
					<p class="text" style="font-variation-settings:'wdth' 0, 'wght' 100, 'ital' 0;font-family: GTFlexa;">unique</p>
					<p class="text" style="font-variation-settings:'wdth' 200, 'wght' 800, 'ital' 100;font-family: GTFlexa;">responsivity</p>
					<p class="text" style="font-variation-settings:'wdth' 150, 'wght' 250, 'ital' 75;font-family: GTFlexa;">adaptative</p>
					<p class="text" style="font-variation-settings:'wdth' 50, 'wght' 700, 'ital' 50;font-family: GTFlexa;">system</p>
					</div>
				</div>
				<div style="height:20px; width:70%; margin:0 auto;">
					<div style="height:5px; border-radius:5px; background-color:black; margin:auto; top:75%; position:relative; -ms-transform: translateY(-50%);transform: translateY(-50%);"></div>
					<div class="slider"></div>
					<div style="display:none; height:20px; width:5px; border-radius:5px; background-color:black; margin:auto; top:-50%; position:relative; -ms-transform: translateY(-50%);transform: translateY(-50%);" id="helper"></div>
				</div>
				<p class="currant" id="spacebar">press <strong>(spacebar)</strong><br>to validate</p>
				<p id="r" style="position:absolute; top:0; left:0;"></p>
			</div>
		</div>
		
		<div class="main" style="display:none"  id="score">
			<div class="containerscore" class="settingssize">
				<div class="elementscore">
					<p class="currant"> Level 0 - <strong>100%</strong></p>
				</div>
				<div class="elementscore" style="display: flex;">
					<div>
						<p>steps</p>
					</div>
					<div>
						<p>precision</p>
					</div>
					<div>
						<p>reactivity</p>
					</div>
					<div>
						<p>score</p>
					</div>
				</div>
				<div class="elementscore" style="display: flex;text-align: right;" id="scoreboard">
					<div style="margin-left: 20px;">
						<p>01</p>
						<p>02</p>
						<p>03</p>
						<p>04</p>
					</div>
					<div>
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
					</div>
					<div>
						<p>0</p>
						<p>0</p>
						<p>0</p>
						<p>0</p>
					</div>
					<div style="font-weight: 600;">
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
						<p>0%</p>
					</div>
				</div>
				<div class="elementscore" style="text-align: center;margin-top:20px;display: flex; justify-content: space-evenly;">
					<p>Press <strong>(r)</strong><br> to try again</p>
					<p>Press <strong>(spacebar)</strong><br> to start the<br> next level</p>
				</div>
			</div>
		</div>
		<script>
		var k=false;
		var id = setInterval(loop, 10);
		var touch=false,t=0,sldr,r,lvl=1,step=0,score=[],penalty=[],prm=[],str,mode=0,fonttype,vari=0,totalscore,waitinput=false,fontscore=[];
		var font=['RobotoMono','RobotoMono-Italic','EBGaramond-VariableFont_wght','Quicksand-VariableFont_wght','Hagrid-Variable-trial','Minerale-variable-TRIAL','InterVar','Blacker-Sans-Variable-trial','GTFlexa','Compressa'];
		var fmin=[[100],[100],[400],[300],[100] ,[0   ],[100,0  ],[50 ,100 ],[0  ,100,0  ],[10 ,100 ]];
		var fmax=[[800],[800],[800],[700],[1000],[1000],[900,-10],[499,1000],[200,800,100],[200,1000]];
		var fout;
		function loop() {
			switch(mode) {
				case 0:
					loadReady();
					mode=1;
					break;
				case 1:
					//Wait Input
					ready();
					break;
				case 2:
					//Play Game
					level(lvl);
					break;
				case 3:
					continueLevel(lvl<4);
					if(step==Math.min(lvl,4)) {
						mode=4;
						k=false;
					}
					break;
				case 4:
					//Load Scoreboard
					scoreboard(lvl>3);
					break;
				case 5:
					//Wait
					waitscore();
					break;
				case 6:
					mode=0;
					step=0;
			}
			function loadReady() {
				//Load Ready?
				t=0;
				document.getElementById("headerready").style.display="flex";
				document.getElementById("headerready").children[1].children[0].innerHTML="Level "+lvl;
				document.getElementById("affiche").innerHTML="Ready?";
				document.getElementById("affiche").style.opacity=1;
				document.getElementsByClassName("slider")[0].style.opacity=1;
				if(lvl==1) {
					document.getElementById("spacebar").innerHTML="Touch the <strong>(screen)</strong><br>or Press <strong>(spacebar)</strong><br> to start";				
				}else if(touch) {
					document.getElementById("spacebar").innerHTML="Touch the <strong>(screen)</strong><br>to start";
				} else {
					document.getElementById("spacebar").innerHTML="Press <strong>(spacebar)</strong><br>to start";				
				}
				document.getElementById("spacebar").style.opacity=1;
				document.getElementById("helper").style.display="none";
			}
			function ready() {
				t++;
				sldr=-Math.cos(t/200*Math.PI)/2+.5;
				document.getElementsByClassName("slider")[0].style.marginLeft=sldr*100+"%";
				if(k+"t"==" t") {
					mode++;
					t=-200;
					document.getElementById("headerready").style.display="none";
					document.getElementById("headerlevel").style.display="flex";
					document.getElementById("headerlevel").children[0].children[0].innerHTML="Level "+lvl;
					document.getElementById("headerlevel").children[0].children[1].innerHTML=0+"/"+Math.min(lvl,4);
				}
			}
			function level(flash) {
				if(flash<4) {
					if(t==-200) {
						startLevel(flash);
						loadFontSettings();
						document.getElementById("affiche").style.opacity=1;
						document.getElementsByClassName("slider")[0].style.opacity=0;
						k=false;
						document.getElementById("spacebar").style.opacity=1;
						if(touch) {
							document.getElementById("spacebar").innerHTML="Click the <strong>(screen)</strong><br>to continue";
						} else {
							document.getElementById("spacebar").innerHTML="Press <strong>(spacebar)</strong><br>to continue";
						}
						t=-1;
						if(flash==3) {
							waitinput=true;
							clearInterval(id);
						} else {
							document.getElementsByClassName("textpar")[lvl].children[step].style.display="block";
						}
					} else if(t==0) { 
						startGame();
					}
					t++;
				}
				if(flash>3) {
					switch(t) {
						case -200:
							startLevel(flash);
							break;
						case -120:
							loadFontSettings();
							//Flash On
							document.getElementById("affiche").style.opacity=1;
							break;
						case -80:
							//Flash Off
							document.getElementById("affiche").style.opacity=0;
							break;
						case 0:
							startGame();
							break;
					}
					t++;
				}
				
				if(0<t) {
					if(k+"t"==" t") {
						saveScore();
						mode++;
						t=0;
					} else {
						moveGame();
					}
				}
			}
			function continueLevel(wait) {
				if(wait &&t==0) {
					t=100
					waitinput=true;
					clearInterval(id);
				} else if(t==100) {
					if(vari==fonttype.length-1) {
						resetAdvance();
					} else {
						advanceVarType();
					}
					mode--;
				} else {
					t++;
				}
			}
			function startLevel(flash) {
				score.push([]);
				penalty.push(0);
				if(flash==1) {
					document.getElementById("helper").style.display="block";
				}
				document.getElementsByClassName("slider")[0].style.opacity=0;
				if(touch) {
					document.getElementById("spacebar").innerHTML="Click the <strong>(screen)</strong><br>to validate";
				} else {
					document.getElementById("spacebar").innerHTML="Hit <strong>(spacebar)</strong><br>to validate";					
				}
				document.getElementById("spacebar").style.opacity=0;
				document.getElementById("affiche").style.opacity=0;
			}
			function loadFontSettings() {
				//Get Font settings 
				document.getElementById("affiche").style.fontFamily=document.getElementsByClassName("textpar")[lvl].children[step].style.fontFamily;
				document.getElementById("affiche").style.fontVariationSettings=document.getElementsByClassName("textpar")[lvl].children[step].style.fontVariationSettings;
				document.getElementById("affiche").innerHTML=document.getElementsByClassName("textpar")[lvl].children[step].innerHTML;
				fout=searchFont(document.getElementsByClassName("textpar")[lvl].children[step].style.fontFamily);
				document.getElementById("r").innerHTML=document.getElementsByClassName("textpar")[lvl].children[step].style.fontFamily;
				prm=[];
				fonttype=[];
				var fontvar= document.getElementsByClassName("textpar")[lvl].children[step].style.fontVariationSettings.split(", ")
				for(var i=0;i<fontvar.length;i++) {
					fontvar[i]=fontvar[i].split(" ");
				}
				for(var i=0;i<fontvar.length;i++) {
					fonttype.push(fontvar[i][0]);
					prm.push((fontvar[i][1]-fout[0][i])/(fout[1][i]-fout[0][i]));
				}
			}
			
			function startGame() {
				//Start Game
				document.getElementById("affiche").style.opacity=1;
				document.getElementsByClassName("slider")[0].style.marginLeft=0+"%";
				document.getElementsByClassName("slider")[0].style.opacity=1;
				document.getElementById("spacebar").style.opacity=1;
				if(touch) {
					document.getElementById("spacebar").innerHTML= "Click the <strong>(screen)</strong><br>to validate";
				} else {
					document.getElementById("spacebar").innerHTML= "Hit <strong>(spacebar)</strong><br>to validate";
				}
				k=false;
			}
			function moveGame() {
				//Move Game
				r=Math.floor(t/200);
				sldr=-Math.cos(t/200*Math.PI)/2+.5;
				var fontvariation="";
				for(var i=0;i<fonttype.length;i++) {
					fontvariation+=fonttype[i]+" ";
					if(i<vari) {
						fontvariation+=fontscore[i]*(fout[1][i]-fout[0][i])+fout[0][i];
					} else if(i==vari) {
						fontvariation+=sldr*(fout[1][i]-fout[0][i])+fout[0][i];
					} else {
						fontvariation+=fout[0][i];
					}
					if(i!=fonttype.length-1) {
						fontvariation+=", ";
					}
				}
				document.getElementById("affiche").style.fontVariationSettings=fontvariation;
				document.getElementsByClassName("slider")[0].style.marginLeft=sldr*100+"%";	
			}
			function saveScore() {
				//Save Score/Input Time
				fontscore.push(sldr);
				score[step].push(1-Math.abs(sldr-prm[vari]));//1-Math.abs(sldr-prm[0])
				penalty[step]+=r;
				k=false;
				if(vari==fonttype.length-1) {
					document.getElementsByClassName("textpar")[lvl].children[step].style.display="block";
				}
			}
			function resetAdvance() {
				//Reset & Advance Game
				document.getElementsByClassName("slider")[0].style.opacity=0.5;
				document.getElementById("affiche").style.opacity=0.5;
				document.getElementById("spacebar").style.opacity=0.5;
				document.getElementsByClassName("textpar")[lvl].children[step].style.display="none";
				step++;
				fontscore=[];
				vari=0;
				t=-200;
				document.getElementById("headerlevel").children[0].children[1].innerHTML=step+"/"+Math.min(lvl,4);
			}
			function advanceVarType() {
				vari++;
				t=0;
			}
			function searchFont(fnt) {
				for(var i=0;i<font.length;i++) {
					if(fnt==font[i]) {
						return [fmin[i],fmax[i]];
					}
				}
			}
			function scoreboard(bounce) {
				if(bounce) {
					document.getElementById("score").children[0].children[1].children[2].style.display="block";
					document.getElementById("score").children[0].children[2].children[2].style.display="block";
				} else {
					document.getElementById("score").children[0].children[1].children[2].style.display="none";					
					document.getElementById("score").children[0].children[2].children[2].style.display="none";					
				}
				document.getElementById("headerlevel").style.display="none";
				document.getElementById("headerscore").style.display="flex";
				document.getElementById("score").style.display="flex";
				document.getElementById("game").style.filter= "blur(8px)";
				totalscore=0;
				for(var i=0;i<4;i++) {
					if(i<Math.min(lvl,4)) {
						document.getElementById("score").children[0].children[2].children[0].children[i].style.display="block";					
						document.getElementById("score").children[0].children[2].children[1].children[i].style.display="block";					
						document.getElementById("score").children[0].children[2].children[2].children[i].style.display="block";					
						document.getElementById("score").children[0].children[2].children[3].children[i].style.display="block";					
					} else {
						document.getElementById("score").children[0].children[2].children[0].children[i].style.display="none";					
						document.getElementById("score").children[0].children[2].children[1].children[i].style.display="none";					
						document.getElementById("score").children[0].children[2].children[2].children[i].style.display="none";					
						document.getElementById("score").children[0].children[2].children[3].children[i].style.display="none";		
					
					}
				}
				for(var i=0;i<score.length;i++) {
					if(bounce==false) {
						penalty[i]=0;
					}
					var scorestep=0;
					for(var j=0;j<score[i].length;j++) {
						scorestep+=score[i][j];
					}
					score[i]=Math.ceil(scorestep/score[i].length*100);
					document.getElementById("scoreboard").children[1].children[i].innerHTML=score[i]+"%";
					document.getElementById("scoreboard").children[2].children[i].innerHTML=penalty[i];
					document.getElementById("scoreboard").children[3].children[i].innerHTML=Math.ceil(score[i]/(penalty[i]+1))+"%";
					totalscore+=Math.ceil(score[i]/(penalty[i]+1));
				}
				totalscore=Math.floor(totalscore/score.length);
				document.getElementById("scoreboard").parentElement.children[0].children[0].innerHTML=" Level "+lvl+" - <strong>"+totalscore+"%</strong>";
				
				mode++;
				k=false;
			}
			function waitscore() {
				if(k+"t"==" t" || k=="r" || k=="R") {
					document.getElementById("headerscore").style.display="none";
					
					document.getElementById("score").style.display="none";
					document.getElementById("game").style.filter= "none";
					score=[];
					penalty=[];
					if(k!="r") {
						lvl++;
					}
					k=false;
					mode++;
				}
			}
		}
		function Click() {
			keyPressed(" ");
		}
		function keyboard(event) {
			keyPressed(event.key);
		}
		function keyPressed(key) {
			if(key=="Escape") {
				clearInterval(id);
			} else if(waitinput) {
				k=false;
				id = setInterval(loop, 10);
				waitinput=false;
			} else {
				k=key;
			}
		}
		function touchScreen() {
			touch=true;
		}
		</script>
	</body>
</html>
